<div class="section-container export-section">
  <div class="export-header">
    <h2>Export Résumé</h2>
    <div class="form-field filename-field">
      <label for="exportFilename"> </label>
      <input
        type="text"
        id="exportFilename"
        [(ngModel)]="exportFilename"
        placeholder="Enter filename or leave blank for default"
        name="exportFilename"
        class="styled-input" />
    </div>
  </div>

  <div class="export-options">
    <div class="export-sidebar" *ngIf="!previewOnly">
      <h3>Export Settings</h3>

      <div class="form-group">
        <label for="theme">Theme</label>
        <select id="theme" [(ngModel)]="selectedTheme" name="theme">
          <option *ngFor="let theme of themes" [value]="theme.id">{{ theme.name }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="fontSize">Font Size</label>
        <select id="fontSize" [(ngModel)]="selectedFontSize" name="fontSize">
          <option *ngFor="let size of fontSizes" [value]="size.id">{{ size.name }}</option>
        </select>
      </div>

      <div class="form-group">
        <div class="checkbox-field">
          <input
            type="checkbox"
            id="includeSignatureLine"
            [(ngModel)]="includeSignatureLine"
            (change)="saveSignaturePreference()"
            name="includeSignatureLine" />
          <label for="includeSignatureLine">Include signature line</label>
        </div>

        <div class="signature-options" *ngIf="includeSignatureLine">
          <div class="checkbox-field">
            <input
              type="checkbox"
              id="useDigitalSignature"
              [(ngModel)]="useDigitalSignature"
              (change)="saveSignaturePreference()"
              name="useDigitalSignature" />
            <label for="useDigitalSignature">Use digital signature</label>
          </div>

          <div class="signature-upload-area" *ngIf="useDigitalSignature">
            <div *ngIf="signatureImageUrl" class="signature-preview">
              <img [src]="signatureImageUrl" alt="Your signature" class="signature-img" />
              <button type="button" (click)="removeSignatureImage()" class="btn-remove-image">Remove</button>
            </div>

            <label *ngIf="!signatureImageUrl" for="signatureUpload" class="upload-label">
              Upload signature image
              <input
                type="file"
                id="signatureUpload"
                (change)="onSignatureImageSelected($event)"
                accept="image/*"
                class="file-input" />
            </label>
          </div>
        </div>
      </div>

      <!-- QR code export settings section -->
      <div class="form-group">
        <div class="checkbox-field">
          <input
            type="checkbox"
            id="includeQrCode"
            [(ngModel)]="includeQrCode"
            (change)="saveQrCodePreference()"
            name="includeQrCode" />
          <label for="includeQrCode">Include QR code</label>
        </div>

        <div class="qr-options" *ngIf="includeQrCode">
          <div class="form-field">
            <label for="qrCodeSize">QR Code Size</label>
            <select id="qrCodeSize" [(ngModel)]="qrCodeSize" (change)="saveQrCodePreference()" name="qrCodeSize">
              <option value="small">Small</option>
              <option value="medium">Medium</option>
              <option value="large">Large</option>
            </select>
          </div>
          <p class="option-description">Uses your customized QR code from the QR Code section</p>
        </div>
      </div>

      <!-- show icons for contact -->
      <div class="form-group">
        <div class="checkbox-field">
          <input
            type="checkbox"
            id="showContactIcons"
            [(ngModel)]="showContactIcons"
            (change)="saveIconPreference()"
            name="showContactIcons" />
          <label for="showContactIcons">Show contact & social media icons</label>
        </div>
      </div>

      <div class="form-group">
        <div class="checkbox-field">
          <input
            type="checkbox"
            id="showHyperlinkUrls"
            [(ngModel)]="showHyperlinkUrls"
            (change)="saveHyperlinkPreference()"
            name="showHyperlinkUrls" />
          <label for="showHyperlinkUrls">Show URLs instead of link text</label>
        </div>
      </div>

      <div class="form-group">
        <div class="checkbox-field">
          <input
            type="checkbox"
            id="useDefaultPillColors"
            [(ngModel)]="useDefaultPillColors"
            name="useDefaultPillColors" />
          <label for="useDefaultPillColors">Use default colors for skills (instead of theme colors)</label>
        </div>
      </div>

      <div class="export-actions">
        <button (click)="exportAsPDF()" [disabled]="isGeneratingPDF" class="btn-export">
          <span *ngIf="!isGeneratingPDF">Export as PDF</span>
          <span *ngIf="isGeneratingPDF">Generating...</span>
        </button>

        <button (click)="exportAsWord()" class="btn-export">Export as Word</button>

        <div class="markdown-section">
          <h4>Markdown Format</h4>
          <p>Copy your résumé content as Markdown</p>
          <button (click)="copyMarkdown()" class="btn-copy">Copy Markdown</button>
        </div>
      </div>

      <div class="data-management-section">
        <h3>Data Management</h3>
        <p class="warning-text">This action will permanently delete all your resume data.</p>

        <button type="button" class="btn-reset-all" (click)="clearAllResumeData()">
          <i class="material-icons">delete_forever</i> Reset All Résumé Data
        </button>
      </div>

      <div *ngIf="exportMessage" class="export-message">{{ exportMessage }}</div>
    </div>

    <div class="export-preview">
      <div class="preview-header">
        <h3>Preview</h3>
        <button (click)="togglePreview()" class="btn-toggle">
          {{ showPreview ? 'Hide Preview' : 'Show Preview' }}
        </button>
      </div>

      <div
        *ngIf="showPreview"
        #resumePreview
        class="resume-preview"
        [ngClass]="[selectedTheme, selectedFontSize, showHyperlinkUrls ? 'show-urls' : '']">
        <!-- Profile Section -->
        <div class="preview-section preview-profile">
          <div class="profile-header">
            <!-- Add profile photo container -->
            <div class="profile-photo-container" *ngIf="resumeService.getProfile()?.photoUrl">
              <img [src]="resumeService.getProfile()?.photoUrl" alt="Profile Photo" class="profile-photo" />
            </div>

            <div class="profile-info">
              <h1>{{ resumeService.getProfile()?.fullName }}</h1>
              <p class="profile-title">{{ resumeService.getProfile()?.title }}</p>

              <div class="profile-contact" [class.hide-icons]="!showContactIcons">
                <span *ngIf="resumeService.getProfile()?.email" class="contact-icon icon-email">
                  {{ resumeService.getProfile()?.email }}
                </span>
                <span *ngIf="resumeService.getProfile()?.phone" class="contact-icon icon-phone">
                  {{ resumeService.getProfile()?.phone }}
                </span>
                <span *ngIf="resumeService.getProfile()?.location" class="contact-icon icon-location">
                  {{ resumeService.getProfile()?.location }}
                </span>
              </div>

              <div class="profile-links" [class.hide-icons]="!showContactIcons">
                <a
                  *ngIf="resumeService.getProfile()?.github"
                  [href]="resumeService.getProfile()?.github"
                  target="_blank"
                  class="contact-icon icon-github">
                  {{ showHyperlinkUrls ? resumeService.getProfile()?.github : 'GitHub' }}
                </a>
                <a
                  *ngIf="resumeService.getProfile()?.linkedin"
                  [href]="resumeService.getProfile()?.linkedin"
                  target="_blank"
                  class="contact-icon icon-linkedin">
                  {{ showHyperlinkUrls ? resumeService.getProfile()?.linkedin : 'LinkedIn' }}
                </a>
                <a
                  *ngIf="resumeService.getProfile()?.portfolio"
                  [href]="resumeService.getProfile()?.portfolio"
                  target="_blank"
                  class="contact-icon icon-website">
                  {{ showHyperlinkUrls ? resumeService.getProfile()?.portfolio : 'Portfolio' }}
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- About Section -->
        <div *ngIf="resumeService.getAbout()" class="preview-section preview-about">
          <h2>About</h2>
          <p>{{ resumeService.getAbout() }}</p>
        </div>

        <!-- Skills Section -->
        <div
          class="skills-preview-section"
          *ngIf="((leftColumnSkillGroups?.length && leftColumnSkillGroups.length > 0)  
          || (rightColumnSkillGroups?.length && rightColumnSkillGroups.length > 0))">
          <h3 class="section-title">Skills</h3>
          <div class="skills-divider"></div>

          <div class="skills-columns-container">
            <!-- Left column -->
            <div class="skills-column">
              <div *ngFor="let skillGroup of leftColumnSkillGroups" class="skill-category">
                <h4 class="category-title">{{skillGroup.category}}</h4>
                <div class="skills-pill-container">
                  <ng-container *ngFor="let skill of skillGroup.skills; let last = last">
                    <span class="skill-pill">{{skill}}</span>
                    <span class="comma" *ngIf="!last">,</span>
                  </ng-container>
                </div>
              </div>
            </div>

            <!-- Right column -->
            <div class="skills-column">
              <div *ngFor="let skillGroup of rightColumnSkillGroups" class="skill-category">
                <h4 class="category-title">{{skillGroup.category}}</h4>
                <div class="skills-pill-container">
                  <ng-container *ngFor="let skill of skillGroup.skills; let last = last">
                    <span class="skill-pill">{{skill}}</span>
                    <span class="comma" *ngIf="!last">,</span>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Experience Section -->
        <div *ngIf="resumeService.getExperiences()?.length" class="preview-section preview-experience">
          <h2>Experience</h2>
          <div *ngFor="let exp of resumeService.getExperiences()" class="experience-item">
            <div class="item-header">
              <h3>{{ exp.position }}</h3>
              <span class="item-date">{{ exp.startDate }} - {{ exp.endDate || 'Present' }}</span>
            </div>
            <div class="item-subheader">
              <span>{{ exp.company }}</span>
              <span *ngIf="exp.location">{{ exp.location }}</span>
            </div>
            <p>{{ exp.description }}</p>
            <ul *ngIf="exp.achievements?.length">
              <li *ngFor="let achievement of exp.achievements">{{ achievement }}</li>
            </ul>
          </div>
        </div>

        <!-- Projects Section -->
        <div *ngIf="resumeService.getProjects()?.length" class="preview-section preview-projects">
          <h2>Projects</h2>
          <div *ngFor="let project of resumeService.getProjects()" class="project-item">
            <div class="item-header">
              <h3>{{ project.name }}</h3>
              <a *ngIf="project.link" [href]="project.link" target="_blank" class="project-link">
                {{ showHyperlinkUrls ? project.link : 'View Project' }}
              </a>
            </div>
            <p>{{ project.description }}</p>
            <div *ngIf="project.technologies" class="project-tech">
              <strong>Technologies:</strong> {{ project.technologies }}
            </div>
          </div>
        </div>

        <!-- Education Section -->
        <div *ngIf="resumeService.getEducation()?.length" class="preview-section preview-education">
          <h2>Education</h2>
          <div *ngFor="let edu of resumeService.getEducation()" class="education-item">
            <div class="item-header">
              <h3>{{ edu.degree }}</h3>
              <span class="item-date">{{ edu.startDate }} - {{ edu.endDate }}</span>
            </div>
            <div class="item-subheader">
              <span>{{ edu.institution }}</span>
              <span *ngIf="edu.location">{{ edu.location }}</span>
            </div>
            <div *ngIf="edu.cgpa" class="item-cgpa"><strong>CGPA/Percentage:</strong> {{ edu.cgpa }}</div>
            <p *ngIf="edu.description">{{ edu.description }}</p>
          </div>
        </div>

        <!-- Certificates Section -->
        <div *ngIf="resumeService.getCertificates()?.length" class="preview-section preview-certificates">
          <h2>Certifications</h2>
          <div *ngFor="let cert of resumeService.getCertificates()" class="certificate-item">
            <div class="item-header">
              <h3>{{ cert.name }}</h3>
              <span class="item-date" *ngIf="cert.date">{{ cert.date }}</span>
            </div>
            <div class="item-subheader">
              <span>{{ cert.issuer }}</span>
              <span *ngIf="cert.credentialId" class="credential-id">ID: {{ cert.credentialId }}</span>
            </div>
            <a *ngIf="cert.url" [href]="cert.url" target="_blank" class="cert-link">
              {{ showHyperlinkUrls ? cert.url : 'Verify Certificate' }}
            </a>
            <p *ngIf="cert.description">{{ cert.description }}</p>
          </div>
        </div>

        <!-- Languages Section -->
        <div *ngIf="resumeService.getLanguages()?.length" class="preview-section preview-languages">
          <h2>Languages</h2>
          <div class="languages-list">
            <div *ngFor="let lang of resumeService.getLanguages(); let last = last" class="language-item">
              <span class="language-name">{{ lang.name }}</span>
              <span class="language-proficiency">({{ lang.proficiency }})</span>
              <span *ngIf="!last">, </span>
            </div>
          </div>
        </div>

        <!-- General Sections Preview -->
        <div class="resume-preview-section" *ngIf="resumeService.getGeneralSections() as generalSections">
          <div class="resume-section-preview-container">
            <!-- Loop through each section -->
            <div *ngFor="let section of generalSections" class="resume-preview-general-section">
              <!-- Only show sections with entries -->
              <ng-container *ngIf="section.entries && section.entries.length > 0">
                <!-- Section header -->
                <div class="resume-preview-section-header">
                  <h2 class="resume-preview-section-title">{{section.sectionName}}</h2>
                  <!-- <div class="resume-preview-section-divider"></div> -->
                </div>

                <!-- Section entries -->
                <div class="resume-preview-entries-container">
                  <div *ngFor="let entry of section.entries" class="resume-preview-entry">
                    <div class="resume-preview-entry-header">
                      <div class="resume-preview-entry-title">{{entry.title || 'No Title'}}</div>
                      <div class="resume-preview-entry-date">{{formatDateForPreview(entry)}}</div>
                    </div>

                    <div *ngIf="entry.location" class="resume-preview-entry-subtitle">{{entry.location}}</div>

                    <div *ngIf="entry.description" class="resume-preview-entry-description">{{entry.description}}</div>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </div>

        <!-- Personal Details Section -->
        <section *ngIf="!!personalDetails && !isPersonalDetailsEmpty" class="resume-section">
          <h2>Personal Details</h2>

          <div class="personal-details-container">
            <!-- First column -->
            <div class="personal-details-column">
              <div class="detail-item" *ngIf="personalDetails.dateOfBirth">
                <span class="detail-label">Date of Birth</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.dateOfBirth}}</span>
              </div>

              <div class="detail-item" *ngIf="personalDetails.placeOfBirth">
                <span class="detail-label">Place of Birth</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.placeOfBirth}}</span>
              </div>

              <div class="detail-item" *ngIf="personalDetails.nationality">
                <span class="detail-label">Nationality</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.nationality}}</span>
              </div>

              <div class="detail-item" *ngIf="personalDetails.gender">
                <span class="detail-label">Gender</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.gender}}</span>
              </div>

              <div class="detail-item" *ngIf="personalDetails.maritalStatus">
                <span class="detail-label">Marital Status</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.maritalStatus}}</span>
              </div>

              <div
                class="detail-item"
                *ngIf="(personalDetails.gender === 'Female' && 
                                            personalDetails.maritalStatus === 'Married' && 
                                            personalDetails.husbandName)">
                <span class="detail-label">Husband's Name</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.husbandName}}</span>
              </div>

              <div
                class="detail-item"
                *ngIf="!(personalDetails.gender === 'Female' && 
                                            personalDetails.maritalStatus === 'Married') && 
                                            personalDetails.fathersName">
                <span class="detail-label">Father's Name</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.fathersName}}</span>
              </div>
            </div>

            <!-- Second column -->
            <div class="personal-details-column">
              <div
                class="detail-item"
                *ngIf="!(personalDetails.gender === 'Female' && 
                                            personalDetails.maritalStatus === 'Married') && 
                                            personalDetails.mothersName">
                <span class="detail-label">Mother's Name</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.mothersName}}</span>
              </div>

              <div class="detail-item" *ngIf="personalDetails.religion">
                <span class="detail-label">Religion</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.religion}}</span>
              </div>

              <div class="detail-item" *ngIf="personalDetails.passportNumber">
                <span class="detail-label">Passport Number</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.passportNumber}}</span>
              </div>

              <div class="detail-item" *ngIf="personalDetails.drivingLicense">
                <span class="detail-label">Driving License</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.drivingLicense}}</span>
              </div>

              <div class="detail-item" *ngIf="personalDetails.bloodGroup">
                <span class="detail-label">Blood Group</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.bloodGroup}}</span>
              </div>

              <div class="detail-item" *ngIf="personalDetails.hobbies && personalDetails.hobbies.length">
                <span class="detail-label">Hobbies</span>
                <span class="detail-colon">:</span>
                <span class="detail-value">{{personalDetails.hobbies.join(', ')}}</span>
              </div>
            </div>
          </div>

          <!-- Custom fields -->
          <div class="custom-fields" *ngIf="personalDetails.otherInfo && personalDetails.otherInfo.length">
            <div class="detail-item" *ngFor="let info of personalDetails.otherInfo">
              <span class="detail-label">{{info.key}}</span>
              <span class="detail-colon">:</span>
              <span class="detail-value">{{info.value}}</span>
            </div>
          </div>
        </section>

        <!-- Declaration Section -->
        <section class="resume-section" *ngIf="declaration.enabled && declaration.text">
          <p class="declaration-text">{{declaration.text}}</p>
        </section>

        <!-- Resume Footer with QR Code and Signature -->
        <div class="resume-footer" [ngClass]="{'signature-only': includeSignatureLine && !includeQrCode}">
          <!-- Left side: QR Code -->
          <div class="footer-left" *ngIf="includeQrCode && qrData.qrDataString">
            <div class="qr-code-container">
              <qrcode
                [qrdata]="qrData.qrDataString"
                [width]="getQrCodeSize()"
                [errorCorrectionLevel]="'M'"
                [colorDark]="qrData.darkColor"
                [colorLight]="'#ffffff'">
              </qrcode>
              <div class="qr-label">Scan for contact info</div>
            </div>
          </div>

          <!-- Right side: Signature -->
          <div class="footer-right" *ngIf="includeSignatureLine">
            <div *ngIf="!useDigitalSignature || !signatureImageUrl">
              <div class="signature-line"></div>
              <div class="signature-text">Signature ({{ resumeService.getProfile()?.fullName || 'Candidate' }})</div>
            </div>
            <div *ngIf="useDigitalSignature && signatureImageUrl" class="digital-signature">
              <img [src]="signatureImageUrl" alt="Digital signature" class="signature-image" />
              <div class="signature-text">{{ resumeService.getProfile()?.fullName || 'Candidate' }}</div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="!showPreview" class="preview-placeholder">Click "Show Preview" to see how your resume will look</div>
    </div>
  </div>
</div>
